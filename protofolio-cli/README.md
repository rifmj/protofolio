# protofolio-cli

CLI tool for generating TypeScript types from AsyncAPI specifications generated by protofolio.

## Installation

Build from source:

```bash
cargo build --release --package protofolio-cli
```

The binary will be available at `target/release/protofolio`.

## Prerequisites

- Node.js (for running the TypeScript generation script)
- `@asyncapi/modelina` package (install with `npm install` in the workspace root)

## Usage

Generate TypeScript types from an AsyncAPI specification file:

```bash
protofolio generate --spec asyncapi.json --output ./types
```

Or with a YAML file:

```bash
protofolio generate --spec asyncapi.yaml --output ./types
```

### Options

- `--spec` / `-s`: Path to the AsyncAPI specification file (JSON or YAML)
- `--output` / `-o`: Output directory for generated TypeScript types (default: `./types`)
- `--format` / `-f`: Format of the input spec file (`json` or `yaml`). Auto-detected from file extension if not specified.

## Example Workflow

1. Generate an AsyncAPI spec from your Rust code:

```rust
use protofolio::AsyncApi;
use protofolio_derive::AsyncApi;

#[derive(AsyncApi)]
#[asyncapi(info(title = "My API", version = "1.0.0"), channels("events"), messages(Event))]
pub struct MyApi;

fn main() {
    let json = MyApi::asyncapi_json().unwrap();
    std::fs::write("asyncapi.json", json).unwrap();
}
```

2. Generate TypeScript types:

```bash
protofolio generate --spec asyncapi.json --output ./types
```

3. Use the generated types in your TypeScript/JavaScript project:

```typescript
import { Event } from './types';

const event: Event = {
  id: "123",
  data: "example"
};
```

## How It Works

1. The CLI reads the AsyncAPI specification file (JSON or YAML)
2. It validates and parses the specification
3. It writes the spec to a temporary JSON file
4. It calls the Node.js script (`scripts/generate-types.js`) which uses Modelina to generate TypeScript types
5. The generated types are written to the specified output directory

## Generated Output

The CLI generates:
- Individual TypeScript interface files for each message type (e.g., `Event.ts`)
- An `index.ts` file that exports all types for easy importing

