# Cursor Rules for protofolio

Rust workspace for AsyncAPI 3.0 spec generation from code annotations via procedural macros.

## Code Style
- Rust 1.80+ (MSRV), Edition 2021
- Follow Rust API guidelines
- `pub(crate)` for internal APIs
- Type-safe enums over strings
- Centralize errors in `error.rs`
- Deny unsafe code, require docs for public APIs

## Error Handling
- Production: `try_asyncapi()` (Result)
- Development: `asyncapi()` (panic)
- Errors in `error.rs` via `thiserror`

## Naming
- Channels: dot-separated (`order.created`, `order.status.changed`)
- Message IDs: include version (`order-created-v1`)
- Channels: NO versions (use `messageId`)

## Architecture
- Separation of concerns per module
- Clean public API via `lib.rs`
- `pub(crate)` for internals
- Modular, extensible

## Guidelines
- Add helpful error messages with hints
- Consider backwards compatibility
- Add tests for new features
- Update `docs/` when changing behavior
- Follow existing patterns

## Key Modules
- `protofolio/src/spec/` - AsyncAPI structures
- `protofolio/src/schema/` - Schema generation (cached)
- `protofolio/src/validation/` - Validation
- `protofolio-derive/src/asyncapi/` - Main macro
- `protofolio-derive/src/message/` - Message macro
- `protofolio-derive/src/operation/` - Operation macro

## Testing
- Unit tests co-located
- Integration tests in `tests/`
- Trybuild tests for macro errors
- Test both `asyncapi()` and `try_asyncapi()`
